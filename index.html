<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centennial Forest Research/Teaching Application</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Warm Earthy Neutrals -->
    <!-- Application Structure Plan: A multi-step, wizard-style form. This structure breaks down the long application into manageable, thematic sections (Contact, Project, Site, etc.), reducing cognitive load and guiding the user through the process. A progress bar provides clear feedback on their location within the application. Crucially, the form uses conditional logic to show a "Research Funding & Publications" step only to research applicants, streamlining the experience for teaching applicants. This interactive, guided approach is more user-friendly and efficient than the original static document. -->
    <!-- Visualization & Content Choices: The primary "visualization" is the interactive form structure itself. Report Info: Entire application form. Goal: Organize & Inform. Presentation Method: Multi-step wizard interface with a progress bar. Interaction: Users click "Next/Previous" to navigate steps. Radio buttons for "Application Type" control the visibility of the final research-specific step. Standard form inputs collect data. Justification: This transforms a static data collection task into an engaging, guided user experience. Library/Method: Vanilla JavaScript for state management and DOM manipulation to control step visibility and data flow. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .step-indicator {
            transition: all 0.3s ease;
        }
        .step-indicator.active {
            background-color: #386641; /* Dark Green */
            color: #FFFFFF;
            border-color: #386641;
        }
        .step-indicator.completed {
            background-color: #6A994E; /* Lighter Green */
            color: #FFFFFF;
            border-color: #6A994E;
            cursor: pointer;
        }
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
        }
        .btn-primary {
            background-color: #386641;
            color: #FFFFFF;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #2a4c31;
        }
        .btn-secondary {
            background-color: #E5E7EB;
            color: #1F2937;
            transition: background-color 0.3s;
        }
        .btn-secondary:hover {
            background-color: #D1D5DB;
        }
        #submission-modal {
            transition: opacity 0.3s ease;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-[#F4F1E8] text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-[#386641]">Centennial Forest Application</h1>
            <p class="text-gray-600 mt-2">Interactive Application for Research & Teaching Proposals</p>
        </header>

        <main class="bg-white p-6 md:p-10 rounded-2xl shadow-lg">
            <!-- Progress Bar -->
            <div id="progress-bar" class="flex items-center justify-center mb-8 flex-wrap"></div>

            <!-- Form Steps -->
            <form id="application-form">
                <!-- Step 1: Application Type -->
                <div id="step-1" class="form-step active">
                    <h2 class="text-2xl font-bold mb-2 text-gray-700">Application Type</h2>
                    <p class="text-gray-500 mb-6">First, tell us what kind of application you're submitting. This will tailor the form to your needs.</p>
                    <div class="space-y-4">
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-green-50">
                            <input type="radio" name="applicationType" value="research" class="h-5 w-5 text-green-700 border-gray-300 focus:ring-green-500">
                            <span class="ml-4">
                                <span class="font-bold text-gray-800">New Research Application</span>
                                <span class="block text-sm text-gray-500">For new scientific or academic research projects.</span>
                            </span>
                        </label>
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-green-50">
                            <input type="radio" name="applicationType" value="teaching" class="h-5 w-5 text-green-700 border-gray-300 focus:ring-green-500">
                            <span class="ml-4">
                                <span class="font-bold text-gray-800">New Teaching Application</span>
                                <span class="block text-sm text-gray-500">For educational activities, courses, and field trips.</span>
                            </span>
                        </label>
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-green-50">
                            <input type="radio" name="applicationType" value="renewal" class="h-5 w-5 text-green-700 border-gray-300 focus:ring-green-500">
                            <span class="ml-4">
                                <span class="font-bold text-gray-800">Research Renewal</span>
                                <span class="block text-sm text-gray-500">To continue an existing research project (renewed every 5 years).</span>
                            </span>
                        </label>
                    </div>
                    <div id="step-1-error" class="text-red-500 text-sm mt-4 hidden">Please select an application type.</div>
                </div>

                <!-- Step 2: Contact Information -->
                <div id="step-2" class="form-step">
                    <h2 class="text-2xl font-bold mb-6 text-gray-700">Contact Information</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
                            <input type="text" id="name" name="name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                        <div>
                            <label for="title" class="block text-sm font-medium text-gray-700">Title</label>
                            <input type="text" id="title" name="title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                        <div>
                            <label for="organization" class="block text-sm font-medium text-gray-700">Organization</label>
                            <input type="text" id="organization" name="organization" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                        <div>
                            <label for="workPhone" class="block text-sm font-medium text-gray-700">Work Phone</label>
                            <input type="tel" id="workPhone" name="workPhone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                         <div class="md:col-span-2">
                            <label for="streetAddress" class="block text-sm font-medium text-gray-700">Street Address</label>
                            <input type="text" id="streetAddress" name="streetAddress" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                            <input type="email" id="email" name="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                        <div>
                            <label for="fax" class="block text-sm font-medium text-gray-700">FAX</label>
                            <input type="tel" id="fax" name="fax" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                    </div>
                </div>

                <!-- Step 3: Project / Course Details -->
                <div id="step-3" class="form-step">
                    <h2 class="text-2xl font-bold mb-6 text-gray-700">Project / Course Details</h2>
                    <div class="space-y-6">
                        <div>
                            <label for="projectTitle" class="block text-sm font-medium text-gray-700">Project/Course Title</label>
                            <input type="text" id="projectTitle" name="projectTitle" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                        <div>
                            <label for="projectObjectives" class="block text-sm font-medium text-gray-700">Project/Course Objectives</label>
                            <p class="text-xs text-gray-500">Please describe research questions and management implications.</p>
                            <textarea id="projectObjectives" name="projectObjectives" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></textarea>
                        </div>
                        <div>
                            <label for="projectDescription" class="block text-sm font-medium text-gray-700">Project/Course Description</label>
                            <textarea id="projectDescription" name="projectDescription" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></textarea>
                        </div>
                        <div>
                            <label for="projectMethods" class="block text-sm font-medium text-gray-700">Project/Course Methods</label>
                            <p class="text-xs text-gray-500">Describe any potentially destructive or invasive activities (e.g., tree removal, soil disturbance, etc.).</p>
                            <textarea id="projectMethods" name="projectMethods" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Step 4: Site Information -->
                <div id="step-4" class="form-step">
                    <h2 class="text-2xl font-bold mb-6 text-gray-700">Site Information</h2>
                    <div class="space-y-6">
                        <div>
                            <label for="proposedLocation" class="block text-sm font-medium text-gray-700">Proposed Location</label>
                            <p class="text-xs text-gray-500">A map and GPS coordinates are required. GIS data is recommended.</p>
                            <textarea id="proposedLocation" name="proposedLocation" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></textarea>
                        </div>
                        <div>
                            <label for="duration" class="block text-sm font-medium text-gray-700">Duration of Study</label>
                             <p class="text-xs text-gray-500">Include proposed starting date.</p>
                            <input type="text" id="duration" name="duration" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                        <div>
                            <label for="visits" class="block text-sm font-medium text-gray-700">Number of Visits, People Involved, and Season of Use</label>
                            <input type="text" id="visits" name="visits" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                         <div>
                            <label for="siteDescription" class="block text-sm font-medium text-gray-700">Describe the Site</label>
                             <p class="text-xs text-gray-500">Include size, number of trees, etc.</p>
                            <textarea id="siteDescription" name="siteDescription" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Infrastructure and Site Management -->
                <div id="step-5" class="form-step">
                    <h2 class="text-2xl font-bold mb-6 text-gray-700">Infrastructure & Site Management</h2>
                    <div class="space-y-6">
                        <div>
                            <label for="infrastructure" class="block text-sm font-medium text-gray-700">Will you require infrastructure? (e.g., metal tree tags, rebar, fencing)</label>
                            <input type="text" id="infrastructure" name="infrastructure" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                        <div>
                            <label for="siteIdentification" class="block text-sm font-medium text-gray-700">How will the site be identified? (e.g., flagging, pin flags)</label>
                            <input type="text" id="siteIdentification" name="siteIdentification" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                         <div>
                            <label class="block text-sm font-medium text-gray-700">Is this a permanent or temporary site?</label>
                            <div class="mt-2 flex space-x-4">
                               <label class="flex items-center"><input type="radio" name="siteType" value="permanent" class="h-4 w-4 text-green-700 border-gray-300 focus:ring-green-500"><span class="ml-2">Permanent</span></label>
                               <label class="flex items-center"><input type="radio" name="siteType" value="temporary" class="h-4 w-4 text-green-700 border-gray-300 focus:ring-green-500"><span class="ml-2">Temporary</span></label>
                            </div>
                        </div>
                        <div>
                            <label for="protectionMeasures" class="block text-sm font-medium text-gray-700">What protection measures are needed for the study area?</label>
                            <input type="text" id="protectionMeasures" name="protectionMeasures" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">What management actions are compatible with your use of the site?</label>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm">Broadcast Burning</span>
                                    <div class="flex space-x-2"><label><input type="radio" name="burn" value="yes"> Y</label><label><input type="radio" name="burn" value="no"> N</label></div>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm">Pre-commercial Thinning</span>
                                    <div class="flex space-x-2"><label><input type="radio" name="preThin" value="yes"> Y</label><label><input type="radio" name="preThin" value="no"> N</label></div>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm">Commercial Tree Thinning</span>
                                    <div class="flex space-x-2"><label><input type="radio" name="comThin" value="yes"> Y</label><label><input type="radio" name="comThin" value="no"> N</label></div>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm">Linear Fuels Treatments</span>
                                    <div class="flex space-x-2"><label><input type="radio" name="fuel" value="yes"> Y</label><label><input type="radio" name="fuel" value="no"> N</label></div>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm">Wildfire</span>
                                    <div class="flex space-x-2"><label><input type="radio" name="wildfire" value="desirable"> D</label><label><input type="radio" name="wildfire" value="undesirable"> U</label></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 6: Research Funding & Publications -->
                <div id="step-6" class="form-step">
                    <h2 class="text-2xl font-bold mb-6 text-gray-700">Research Funding & Publications</h2>
                    <p class="text-gray-500 mb-6">This section is for research applications and renewals only.</p>
                    <div class="space-y-6">
                        <div>
                            <label for="fundingInfo" class="block text-sm font-medium text-gray-700">Funding Information</label>
                            <p class="text-xs text-gray-500">Title on grant proposal, granting agency, total grant amount.</p>
                            <textarea id="fundingInfo" name="fundingInfo" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></textarea>
                        </div>
                        <div>
                            <label for="publications" class="block text-sm font-medium text-gray-700">Products and Publications</label>
                            <p class="text-xs text-gray-500">Required for renewal applications.</p>
                            <textarea id="publications" name="publications" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Step 7: Review & Submit -->
                <div id="step-7" class="form-step">
                     <h2 class="text-2xl font-bold mb-6 text-gray-700">Review Your Application</h2>
                     <p class="text-gray-500 mb-6">Please review all the information you have provided. Click "Edit" next to any section to make changes.</p>
                     <div id="review-content" class="space-y-6"></div>
                </div>

                <!-- Navigation Buttons -->
                <div class="mt-10 flex justify-between">
                    <button type="button" id="prev-btn" class="btn-secondary py-2 px-4 rounded-md font-medium hidden">Previous</button>
                    <button type="button" id="next-btn" class="btn-primary py-2 px-4 rounded-md font-medium">Next</button>
                    <button type="button" id="submit-btn" class="btn-primary py-2 px-4 rounded-md font-medium hidden">Submit Application</button>
                </div>
            </form>
        </main>
        
        <footer class="text-center mt-8 text-sm text-gray-500">
            <p>Centennial Forest, Northern Arizona University, School of Forestry</p>
            <p>PO Box 15018, Flagstaff, AZ 86011 | FAX 928/523-1080</p>
        </footer>
    </div>

    <!-- Submission Modal -->
    <div id="submission-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-md text-center">
            <h3 class="text-2xl font-bold text-green-700 mb-4">Submission Ready!</h3>
            <p class="text-gray-600 mb-6">Your application files (PDF and CSV) have been downloaded. Please attach both files to the email that has now opened in your mail client.</p>
            <button id="close-modal-btn" class="btn-primary py-2 px-6 rounded-md font-medium">Close</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const { jsPDF } = window.jspdf;
            const steps = document.querySelectorAll('.form-step');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const submitBtn = document.getElementById('submit-btn');
            const progressBar = document.getElementById('progress-bar');
            const form = document.getElementById('application-form');
            const submissionModal = document.getElementById('submission-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');

            let currentStep = 1;
            let applicationType = null;
            let completedSteps = new Set();
            
            const stepDefinitions = [
                { id: 1, name: 'Type' },
                { id: 2, name: 'Contact' },
                { id: 3, name: 'Details' },
                { id: 4, name: 'Site Info' },
                { id: 5, name: 'Management' },
                { id: 6, name: 'Research', researchOnly: true },
                { id: 7, name: 'Review' }
            ];

            function getVisibleSteps() {
                if (applicationType === 'teaching') {
                    return stepDefinitions.filter(step => !step.researchOnly);
                }
                return stepDefinitions;
            }

            function updateProgressBar() {
                const visibleSteps = getVisibleSteps();
                progressBar.innerHTML = '';
                visibleSteps.forEach((step, index) => {
                    const stepEl = document.createElement('div');
                    stepEl.className = 'step-indicator flex items-center justify-center w-10 h-10 rounded-full border-2 font-bold';
                    stepEl.textContent = index + 1;
                    stepEl.dataset.step = step.id;

                    if (currentStep === step.id) {
                        stepEl.classList.add('active');
                    } else if (completedSteps.has(step.id)) {
                        stepEl.classList.add('completed');
                        stepEl.addEventListener('click', () => goToStep(step.id));
                    }

                    progressBar.appendChild(stepEl);

                    if (index < visibleSteps.length - 1) {
                        const connector = document.createElement('div');
                        connector.className = 'w-12 h-1 bg-gray-200';
                        progressBar.appendChild(connector);
                    }
                });
            }

            function showStep(stepNumber) {
                steps.forEach(step => step.classList.remove('active'));
                document.getElementById(`step-${stepNumber}`).classList.add('active');
                updateButtons();
                updateProgressBar();
            }
            
            function goToStep(stepNumber) {
                if (completedSteps.has(stepNumber) || stepNumber === currentStep + 1 || stepNumber === currentStep - 1) {
                    currentStep = stepNumber;
                    showStep(currentStep);
                }
            }

            function updateButtons() {
                const visibleSteps = getVisibleSteps();
                const currentVisibleIndex = visibleSteps.findIndex(s => s.id === currentStep);

                prevBtn.classList.toggle('hidden', currentVisibleIndex === 0);
                nextBtn.classList.toggle('hidden', currentVisibleIndex === visibleSteps.length - 1);
                submitBtn.classList.toggle('hidden', currentVisibleIndex !== visibleSteps.length - 1);
            }

            function populateReviewPage() {
                const reviewContent = document.getElementById('review-content');
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());
                
                const sections = [
                    { title: 'Application Type', fields: { 'Application Type': applicationType } },
                    { title: 'Contact Information', fields: { Name: data.name, Title: data.title, Organization: data.organization, 'Work Phone': data.workPhone, Address: data.streetAddress, Email: data.email, FAX: data.fax } },
                    { title: 'Project / Course Details', fields: { 'Project Title': data.projectTitle, 'Objectives': data.projectObjectives, 'Description': data.projectDescription, 'Methods': data.projectMethods } },
                    { title: 'Site Information', fields: { 'Location': data.proposedLocation, 'Duration': data.duration, 'Visits': data.visits, 'Site Description': data.siteDescription } },
                    { title: 'Infrastructure & Management', fields: { 'Infrastructure': data.infrastructure, 'Site ID': data.siteIdentification, 'Site Type': data.siteType, 'Protection': data.protectionMeasures } },
                ];

                if (applicationType !== 'teaching') {
                    sections.push({ title: 'Research Funding & Publications', fields: { 'Funding': data.fundingInfo, 'Publications': data.publications } });
                }

                reviewContent.innerHTML = sections.map((section, index) => `
                    <div class="border p-4 rounded-lg">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-bold text-gray-700">${section.title}</h3>
                            <button type="button" class="text-sm text-green-700 hover:underline" onclick="editSection(${index + 1})">Edit</button>
                        </div>
                        <div class="mt-2 text-sm text-gray-600 grid grid-cols-1 sm:grid-cols-2 gap-x-4">
                            ${Object.entries(section.fields).map(([key, value]) => `
                                <div class="py-1">
                                    <strong class="font-medium text-gray-800">${key}:</strong> 
                                    <span class="break-words">${value || 'Not provided'}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            }

            window.editSection = (stepIndex) => {
                const stepId = getVisibleSteps()[stepIndex - 1].id;
                goToStep(stepId);
            };

            nextBtn.addEventListener('click', () => {
                if (currentStep === 1) {
                    const selectedType = document.querySelector('input[name="applicationType"]:checked');
                    if (!selectedType) {
                        document.getElementById('step-1-error').classList.remove('hidden');
                        return;
                    }
                    document.getElementById('step-1-error').classList.add('hidden');
                    applicationType = selectedType.value;
                }
                
                completedSteps.add(currentStep);
                const visibleSteps = getVisibleSteps();
                const currentVisibleIndex = visibleSteps.findIndex(s => s.id === currentStep);

                if (currentVisibleIndex < visibleSteps.length - 1) {
                    currentStep = visibleSteps[currentVisibleIndex + 1].id;
                    if (currentStep === 7) {
                        populateReviewPage();
                    }
                    showStep(currentStep);
                }
            });

            prevBtn.addEventListener('click', () => {
                const visibleSteps = getVisibleSteps();
                const currentVisibleIndex = visibleSteps.findIndex(s => s.id === currentStep);
                if (currentVisibleIndex > 0) {
                    currentStep = visibleSteps[currentVisibleIndex - 1].id;
                    showStep(currentStep);
                }
            });
            
            function triggerDownload(blob, fileName) {
                const a = document.createElement('a');
                a.style.display = 'none';
                document.body.appendChild(a);
                const url = window.URL.createObjectURL(blob);
                a.href = url;
                a.download = fileName;
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            }

            function generateCSV(data) {
                let csvContent = "Field,Value\r\n";
                const formData = new FormData(form);
                for (const [key, value] of formData.entries()) {
                    const formattedValue = `"${(value || '').replace(/"/g, '""')}"`;
                    csvContent += `${key},${formattedValue}\r\n`;
                }
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                triggerDownload(blob, 'application_data.csv');
            }

            function generatePDF(data) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                let y = 20;
                const margin = 15;
                const maxWidth = doc.internal.pageSize.getWidth() - 2 * margin;

                const checkY = (increment) => {
                    if (y + increment > 280) {
                        doc.addPage();
                        y = 20;
                    }
                };

                const addSectionHeader = (title) => {
                    checkY(15);
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'bold');
                    doc.text(title, margin, y);
                    doc.setFont(undefined, 'normal');
                    y += 8;
                    doc.setLineWidth(0.2);
                    doc.line(margin, y, maxWidth + margin, y);
                    y += 8;
                };

                const addField = (label, value) => {
                    checkY(10);
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'bold');
                    doc.text(`${label}:`, margin, y);
                    
                    doc.setFont(undefined, 'normal');
                    const text = value || 'Not provided';
                    const splitText = doc.splitTextToSize(text, maxWidth - 35);
                    doc.text(splitText, margin + 35, y);
                    y += (splitText.length * 5) + 4;
                };
                
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text("Centennial Forest Application", doc.internal.pageSize.getWidth() / 2, 15, { align: 'center' });
                y = 30;

                addSectionHeader("Application Type");
                addField("Type", data.applicationType);

                addSectionHeader("Contact Information");
                addField("Name", data.name);
                addField("Title", data.title);
                addField("Organization", data.organization);
                addField("Work Phone", data.workPhone);
                addField("Street Address", data.streetAddress);
                addField("Email", data.email);
                addField("FAX", data.fax);

                addSectionHeader("Project / Course Details");
                addField("Project/Course Title", data.projectTitle);
                addField("Objectives", data.projectObjectives);
                addField("Description", data.projectDescription);
                addField("Methods", data.projectMethods);

                addSectionHeader("Site Information");
                addField("Proposed Location", data.proposedLocation);
                addField("Duration of Study", data.duration);
                addField("Visits/People/Season", data.visits);
                addField("Site Description", data.siteDescription);

                addSectionHeader("Infrastructure & Site Management");
                addField("Infrastructure Required", data.infrastructure);
                addField("Site Identification", data.siteIdentification);
                addField("Site Type", data.siteType);
                addField("Protection Measures", data.protectionMeasures);
                
                if (applicationType !== 'teaching') {
                    addSectionHeader("Research Funding & Publications");
                    addField("Funding Information", data.fundingInfo);
                    addField("Products/Publications", data.publications);
                }

                doc.save('application_summary.pdf');
            }

            submitBtn.addEventListener('click', () => {
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());

                generateCSV(data);
                generatePDF(data);

                const subject = `Centennial Forest Application: ${data.projectTitle || 'New Submission'}`;
                const body = "Please find my application files (PDF and CSV) attached for the Centennial Forest project.\n\nThank you.";
                window.location.href = `mailto:CentennialForest@nau.edu?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;

                submissionModal.classList.remove('hidden');
                setTimeout(() => submissionModal.classList.remove('opacity-0'), 10);
            });

            closeModalBtn.addEventListener('click', () => {
                submissionModal.classList.add('opacity-0');
                setTimeout(() => submissionModal.classList.add('hidden'), 300);
            });

            showStep(currentStep);
        });
    </script>
</body>
</html>
